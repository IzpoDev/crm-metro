<app-header></app-header>

<main>
  <!-- UC-CRM-02: Actualizar Datos del Cliente -->
  <section class="mb-2">
    <h1 class="text-center mb-2" style="color: var(--primary-color);">
      <i class="fas fa-user-edit"></i> Actualizar Datos del Cliente
    </h1>
    <p class="text-center text-light mb-2">Busque y modifique la información de un cliente existente</p>

    <!-- Búsqueda de Cliente -->
    <div class="card mb-2" style="max-width: 800px; margin: 0 auto;">
      <h3 class="mb-1" style="color: var(--primary-color);">
        <i class="fas fa-search"></i> Buscar Cliente
      </h3>

      <form [formGroup]="buscarForm">
        <div class="form-group">
          <label for="criterio">Criterio de Búsqueda</label>
          <select id="criterio" formControlName="criterio" class="form-control">
            <option value="dni">DNI</option>
            <option value="nombre">Nombre</option>
            <option value="telefono">Teléfono</option>
          </select>
        </div>

        <div class="form-group">
          <label for="valorBusqueda">Valor de Búsqueda</label>
          <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
            <input type="text" id="valorBusqueda" formControlName="valorBusqueda" class="form-control"
              placeholder="Ingrese el valor a buscar" style="flex: 1; min-width: 250px;">
            <button type="button" (click)="onBuscar()" class="btn btn-primary">
              <i class="fas fa-search"></i> Buscar
            </button>
          </div>
        </div>

        <!-- Mensaje de Error de Búsqueda -->
        <div *ngIf="showErrorBusqueda"
          style="background: #ffebee; border-left: 4px solid var(--primary-color); padding: 1rem; border-radius: var(--radius); margin-top: 1rem;">
          <p style="color: var(--primary-color); margin: 0;">
            <i class="fas fa-exclamation-circle"></i> Cliente no registrado. No se encontró ningún cliente con ese
            criterio.
          </p>
        </div>
      </form>
    </div>

    <!-- Formulario de Actualización -->
    <div *ngIf="clienteEncontrado">
      <div class="card" style="max-width: 800px; margin: 0 auto;">
        <!-- Información del Cliente Encontrado -->
        <div
          style="background: #e8f5e9; border-left: 4px solid var(--success-color); padding: 1rem; border-radius: var(--radius); margin-bottom: 2rem;">
          <h4 style="color: #2e7d32; margin-bottom: 0.5rem;">
            <i class="fas fa-check-circle"></i> Cliente Encontrado
          </h4>
          <p style="margin: 0; color: #2e7d32;">
            <strong>Código:</strong> {{ clienteEncontrado.codigo }} |
            <strong>Registrado:</strong> {{ clienteEncontrado.fechaRegistro }}
          </p>
        </div>

        <form [formGroup]="actualizarForm" (ngSubmit)="onActualizar()">
          <!-- Datos Personales -->
          <h3 class="mb-1" style="color: var(--primary-color);">
            <i class="fas fa-id-card"></i> Datos Personales
          </h3>

          <div class="form-group">
            <label for="dni">DNI</label>
            <input type="text" id="dni" formControlName="dni" class="form-control"
              style="background: #f5f5f5; cursor: not-allowed;">
            <small class="text-light">El DNI no puede ser modificado</small>
          </div>

          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
            <div class="form-group">
              <label for="nombres">Nombres *</label>
              <input type="text" id="nombres" formControlName="nombres" class="form-control">
            </div>

            <div class="form-group">
              <label for="apellidos">Apellidos *</label>
              <input type="text" id="apellidos" formControlName="apellidos" class="form-control">
            </div>
          </div>

          <div class="form-group">
            <label for="direccion">Dirección *</label>
            <input type="text" id="direccion" formControlName="direccion" class="form-control">
          </div>

          <!-- Medios de Contacto -->
          <h3 class="mb-1 mt-2" style="color: var(--primary-color);">
            <i class="fas fa-address-book"></i> Medios de Contacto
          </h3>

          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
            <div class="form-group">
              <label for="telefono">Teléfono *</label>
              <input type="tel" id="telefono" formControlName="telefono" class="form-control">
            </div>

            <div class="form-group">
              <label for="correo">Correo Electrónico *</label>
              <input type="email" id="correo" formControlName="correo" class="form-control">
            </div>
          </div>

          <div class="form-group">
            <label for="contactoPrincipal">Medio de Contacto Principal *</label>
            <select id="contactoPrincipal" formControlName="contactoPrincipal" class="form-control">
              <option value="">Seleccione el medio preferido</option>
              <option value="telefono">Teléfono</option>
              <option value="correo">Correo Electrónico</option>
              <option value="whatsapp">WhatsApp</option>
            </select>
          </div>

          <!-- Estado del Cliente -->
          <div class="form-group">
            <label for="estado">Estado del Cliente *</label>
            <select id="estado" formControlName="estado" class="form-control">
              <option value="">Seleccione el estado</option>
              <option value="activo">Activo</option>
              <option value="inactivo">Inactivo</option>
            </select>
          </div>

          <!-- Preferencias de Comunicación -->
          <div class="form-group">
            <label class="mb-1">Preferencias de Comunicación</label>
            <div style="background: #f8f9fa; padding: 1rem; border-radius: var(--radius);">
              <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                <input type="checkbox" id="aceptaPromociones" formControlName="aceptaPromociones"
                  style="width: 20px; height: 20px; accent-color: var(--primary-color);">
                <label for="aceptaPromociones" style="margin: 0; font-weight: normal;">
                  Acepta recibir promociones y ofertas
                </label>
              </div>
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <input type="checkbox" id="aceptaNotificaciones" formControlName="aceptaNotificaciones"
                  style="width: 20px; height: 20px; accent-color: var(--primary-color);">
                <label for="aceptaNotificaciones" style="margin: 0; font-weight: normal;">
                  Acepta recibir notificaciones del sistema
                </label>
              </div>
            </div>
          </div>

          <!-- Mensaje de Error de Validación -->
          <div *ngIf="showErrorValidacion"
            style="background: #ffebee; border-left: 4px solid var(--primary-color); padding: 1rem; border-radius: var(--radius); margin-bottom: 1rem;">
            <p style="color: var(--primary-color); margin: 0;">
              <i class="fas fa-exclamation-circle"></i> {{ errorValidacionMessage }}
            </p>
          </div>

          <!-- Botones -->
          <div style="display: flex; gap: 1rem; margin-top: 2rem;">
            <button type="submit" class="btn btn-primary" style="flex: 1;">
              <i class="fas fa-save"></i> Guardar Cambios
            </button>
            <button type="button" (click)="cancelar()" class="btn btn-outline" style="flex: 1;">
              <i class="fas fa-times"></i> Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- Información Adicional -->
  <section>
    <div class="card" style="max-width: 800px; margin: 0 auto; background: #e3f2fd; border-left: 4px solid #2196F3;">
      <h4 style="color: #1565C0; margin-bottom: 0.5rem;">
        <i class="fas fa-info-circle"></i> Trazabilidad de Cambios
      </h4>
      <p style="margin: 0; color: #1565C0;">
        Toda modificación se almacena con fecha, hora y usuario que la realizó para fines de auditoría.
        Los cambios quedarán registrados en el historial del cliente.
      </p>
    </div>
  </section>
</main>

<app-footer></app-footer>
